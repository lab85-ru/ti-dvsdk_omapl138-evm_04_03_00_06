/* Load platform file for evm6747 */
utils.loadPlatform("ti.platforms.evm6747");

/* Enable Time Stamp Logging */
bios.LOG.TS = true;

/* Enable common BIOS features used by all examples */
bios.enableRealTimeAnalysis(prog);
bios.enableMemoryHeaps(prog);
bios.enableRtdx(prog);
bios.enableTskManager(prog);
bios.setMemCodeSections(prog, prog.get("SDRAM"));

/* Enable ECM Handler */
bios.ECM.ENABLE = true;

/* Import driver TCI files */
utils.importFile("liddSample.tci");
utils.importFile("../../../../platforms/evm6747/lidd.tci");

/*
 * Create a heap in SDRAM
 */
bios.MEM.instance("SDRAM").createHeap = 1;
bios.MEM.instance("SDRAM").heapSize = 0x2000;
bios.MEM.BIOSOBJSEG = prog.get("SDRAM");
bios.MEM.MALLOCSEG = prog.get("SDRAM");

/* setup LOGs */
bios.LOG_system.bufSeg = prog.get("IRAM");
bios.LOG_system.bufLen = 1024;
bios.LOG_system.logType = "circular";

bios.LOG.create("trace");
bios.LOG.instance("trace").bufLen = 1024;
bios.LOG.instance("trace").bufSeg = prog.get("IRAM");

bios.LOG.create("DVTEvent_Log");
bios.LOG.instance("DVTEvent_Log").bufSeg = prog.get("SDRAM");
bios.LOG.instance("DVTEvent_Log").bufLen = 8192;
bios.LOG.instance("DVTEvent_Log").comment = "DVT";

/* Allow DSP to reset timer */
bios.CLK.RESETTIMER = 1;

/* Use instrumented bios libraries */
bios.GBL.ENABLEINST = 1;

/* MAR bits config */
bios.GBL.C64PLUSMAR128to159 = 0x0000ffff;

/* ECM configuration */
bios.HWI.instance("HWI_INT7").interruptSelectNumber  = 0;
bios.HWI.instance("HWI_INT8").interruptSelectNumber  = 1;
bios.HWI.instance("HWI_INT9").interruptSelectNumber  = 2;
bios.HWI.instance("HWI_INT10").interruptSelectNumber = 3;

/* task configuration */
bios.TSK.create("liddTask");
bios.TSK.instance("liddTask").stackSize = 16384;
bios.TSK.instance("liddTask").fxn = prog.extern("liddSampleTask");
bios.TSK.instance("liddTask").comment = "Lidd Sample Application Task";

/* system stack size */
bios.MEM.STACKSIZE = 0x2000;

bios.MEM.FARSEG = prog.get("SDRAM");

bios.GBL.CALLUSERINITFXN = 1;
bios.GBL.USERINITFXN = prog.extern("commonInit");

prog.gen();
